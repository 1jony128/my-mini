# Техническое задание (ТЗ) на разработку веб-приложения "Multi-Model AI Chat"

## 1. Общая информация

**Название проекта:** Multi-Model AI Chat  
**Описание:** Веб-приложение, аналогичное ChatGPT, но с поддержкой нескольких моделей ИИ. Пользователи могут общаться с ИИ в чате, выбирать модели, использовать бесплатные опции и приобретать токены для расширенного доступа. Приложение включает лендинг-страницу, аутентификацию, чат-интерфейс и управление подписками/токенами.

**Цель:** Создать полноценное веб-приложение, готовое к запуску, где разработчик (заказчик) сможет только подставить API-ключи (токены) для интеграции с моделями ИИ. Все остальные настройки, включая backend, frontend, базу данных и платежи, должны быть реализованы.

**Изменения в обновленной версии:** Замена интеграции платежей с Stripe на YooKassa (платежная система от YooMoney). Все упоминания Stripe заменены на YooKassa. Интеграция должна использовать API YooKassa для создания платежей, обработки webhook для подтверждения транзакций и обновления статуса в Supabase.

## 2. Технологический стек

### Frontend
- **Next.js 14** (с использованием App Router для маршрутизации)
- **TypeScript** для типобезопасности
- **Tailwind CSS** для стилизации
- **React Hook Form** для форм
- **React Markdown** для рендеринга ответов ИИ
- **Lucide React** для иконок

### Backend
- **Supabase** (для аутентификации, базы данных, хранения и реального времени)
- **PostgreSQL** (для хранения пользователей, чатов, токенов, подписок)

### Интеграции
- **AI Models:** OpenAI (GPT-3.5, GPT-4), Anthropic (Claude 3 Haiku, Claude 3 Sonnet)
- **Платежи:** YooKassa для российских платежей
- **Аутентификация:** Supabase Auth с Google OAuth

### Дополнительные библиотеки
- **React Hot Toast** для уведомлений
- **React Syntax Highlighter** для подсветки кода
- **Date-fns** для работы с датами
- **Zustand** для управления состоянием

## 3. Функциональные требования

### 3.1. Модели ИИ

**Поддержка нескольких моделей:**
- Бесплатные модели: GPT-3.5 Turbo, Claude 3 Haiku (лимит 1000 токенов в день)
- Платные модели: GPT-4, Claude 3 Sonnet (требуют Pro подписку)

**Выбор модели:**
- Дропдаун в интерфейсе чата для выбора модели
- Отображение статуса модели (бесплатно/Pro)
- Проверка лимитов токенов перед использованием

**Потоковая генерация:**
- Реализация streaming API для моделей ИИ
- Постепенное появление ответа в реальном времени
- Индикатор загрузки во время генерации

### 3.2. Страницы и интерфейс

**Лендинг-страница (Главная):**
- Современный дизайн с градиентами
- Описание приложения и преимуществ
- Секция доступных моделей ИИ
- Кнопки "Войти", "Зарегистрироваться", "Попробовать бесплатно"
- Адаптивный дизайн для мобильных устройств

**Страница входа/регистрации:**
- Формы регистрации и входа с валидацией
- Интеграция с Supabase Auth
- Google OAuth поддержка
- Восстановление пароля
- Редирект на dashboard после входа

**Dashboard (Список чатов):**
- Список всех чатов пользователя
- Функции: создание нового чата, удаление, переименование
- Отображение последнего сообщения и времени
- Адаптивная сетка для разных экранов

**Страница чата:**
- Интерфейс в стиле ChatGPT
- Выбор модели ИИ в верхней части
- Потоковая печать ответов
- Подсветка синтаксиса для кода
- Markdown рендеринг сообщений
- Функции: очистка чата, экспорт в текст

### 3.3. Система токенов и оплаты

**Токены:**
- Каждый запрос к ИИ потребляет токены
- Хранение баланса токенов в Supabase
- Ежедневное начисление бесплатных токенов
- Проверка лимитов перед использованием

**Пакеты токенов:**
- 1,000 токенов - 99 ₽
- 5,000 токенов - 399 ₽
- 10,000 токенов - 699 ₽

**Pro подписка:**
- Месячная подписка - 999 ₽/месяц
- Годовая подписка - 9,999 ₽/год
- Неограниченный доступ ко всем моделям
- Приоритетная поддержка

**Интеграция с YooKassa:**
- Создание платежей через API
- Webhook для обработки подтверждений
- Обновление статуса в Supabase
- Валидация подписей webhook

### 3.4. Дополнительные функции

**Аутентификация и безопасность:**
- Защищенные роуты с middleware
- Row Level Security в Supabase
- Валидация данных на всех уровнях
- Безопасное хранение секретов

**Реальное время:**
- Supabase Realtime для обновлений
- Синхронизация между устройствами
- Уведомления о новых сообщениях

**Локализация:**
- Поддержка русского языка
- Адаптация под российскую аудиторию
- Рубли как основная валюта

## 4. Нефункциональные требования

### Производительность
- Время загрузки страницы < 3 секунд
- Оптимизация для мобильных устройств
- Кэширование статических ресурсов
- Lazy loading для компонентов

### Безопасность
- HTTPS обязателен в продакшене
- Защита от XSS/CSRF атак
- Валидация всех входных данных
- Безопасное хранение API ключей

### Масштабируемость
- Supabase для автоматического масштабирования
- Vercel для edge functions
- CDN для статических файлов
- Оптимизация запросов к базе данных

### Дизайн
- Минималистичный интерфейс в стиле ChatGPT
- Темная/светлая тема
- Адаптивный дизайн
- Соответствие WCAG стандартам

## 5. Интеграции и настройки

### API моделей ИИ
- Настройка клиентских библиотек
- Плейсхолдеры для API ключей
- Обработка ошибок и лимитов
- Поддержка streaming ответов

### YooKassa
- Настройка аккаунта и продуктов
- Webhook для обработки платежей
- Тестовый и продакшн режимы
- Документация по интеграции

### Supabase
- Создание проекта и таблиц
- Настройка RLS политик
- Триггеры для автоматических действий
- Настройка аутентификации

## 6. Структура базы данных

### Таблицы
1. **users** - профили пользователей
2. **chats** - чаты пользователей
3. **messages** - сообщения в чатах
4. **subscriptions** - подписки Pro
5. **payments** - история платежей

### Индексы и оптимизация
- Индексы по user_id, chat_id, created_at
- RLS политики для безопасности
- Триггеры для автоматических обновлений

## 7. Документация и поддержка

### Документация
- README.md с инструкциями по запуску
- DEPLOYMENT.md для деплоя
- SQL схема базы данных
- Описание переменных окружения

### Тестирование
- Unit тесты для ключевых компонентов
- E2E тесты для основных сценариев
- Тестирование интеграций

### Поддержка
- Логирование ошибок
- Мониторинг производительности
- Документация по устранению неполадок

## 8. Готовность к запуску

### После разработки заказчик должен только:
1. Подставить API ключи в переменные окружения
2. Настроить YooKassa ключи
3. Выполнить SQL скрипт в Supabase
4. Деплоить на Vercel

### Переменные окружения
```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key

# AI Models
OPENAI_API_KEY=your_openai_api_key
ANTHROPIC_API_KEY=your_anthropic_api_key

# YooKassa
YOOKASSA_SHOP_ID=your_yookassa_shop_id
YOOKASSA_SECRET_KEY=your_yookassa_secret_key
YOOKASSA_WEBHOOK_SECRET=your_yookassa_webhook_secret

# App
NEXT_PUBLIC_APP_URL=your_app_url
```

## 9. Критерии приемки

### Функциональные критерии
- [ ] Все страницы работают корректно
- [ ] Аутентификация функционирует
- [ ] Чат с ИИ работает
- [ ] Платежи обрабатываются
- [ ] Система токенов работает
- [ ] Pro подписка активируется

### Технические критерии
- [ ] Проект собирается без ошибок
- [ ] TypeScript типизация корректна
- [ ] База данных настроена
- [ ] API интеграции работают
- [ ] Безопасность настроена
- [ ] Производительность оптимизирована

### Критерии готовности
- [ ] Документация создана
- [ ] Инструкции по деплою написаны
- [ ] Переменные окружения описаны
- [ ] SQL скрипты готовы
- [ ] Тестирование проведено

## 10. Сроки и этапы

### Этап 1: Базовая структура (1-2 дня)
- Настройка Next.js проекта
- Конфигурация TypeScript и Tailwind
- Создание базовых компонентов

### Этап 2: Аутентификация (1-2 дня)
- Интеграция с Supabase Auth
- Создание страниц входа/регистрации
- Настройка middleware

### Этап 3: Чат-интерфейс (2-3 дня)
- Создание интерфейса чата
- Интеграция с AI моделями
- Реализация streaming

### Этап 4: Система платежей (2-3 дня)
- Интеграция с YooKassa
- Создание API роутов
- Настройка webhook

### Этап 5: Финальная доработка (1-2 дня)
- Тестирование
- Оптимизация
- Документация

**Общий срок разработки:** 7-12 дней

## 11. Риски и предположения

### Предположения
- Модели ИИ поддерживают streaming API
- YooKassa API стабилен и документирован
- Supabase не имеет критических ограничений

### Риски
- Изменения в API моделей ИИ
- Изменения в YooKassa API
- Ограничения Supabase в продакшене
- Проблемы с производительностью при масштабировании

### Митигация рисков
- Модульная архитектура для легкого обновления
- Обработка ошибок на всех уровнях
- Мониторинг и логирование
- Документация по устранению неполадок

---

**Дата создания ТЗ:** 25.08.2024  
**Версия:** 1.0  
**Статус:** Утверждено



Дальнейшие задачи
- сделать темную тему и ее переключение в настройках
- голосовой ввод текста
